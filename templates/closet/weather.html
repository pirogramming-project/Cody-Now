{% extends "base.html" %}

{% block content %}
  <body>
    <div id="weather"></div>
  </body>

  <script>
    // Django 템플릿 태그를 사용해 API 키를 전달
    const apiKey = "{{OPENWEATHER_API_KEY}}";

    function success(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        console.log(lat, lon);

        // OpenWeather API 호출
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=kr`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                console.log(data); // 날씨 데이터 확인
                displayWeather(data); // 날씨 정보를 페이지에 표시하는 함수
            })
            .catch(error => {
                console.error('날씨 데이터를 불러오는 데 실패했습니다.', error);
            });
    }

    function error() {
        alert("위치 정보를 불러올 수 없습니다.");
    }

    navigator.geolocation.getCurrentPosition(success, error);

    function displayWeather(data) {
        const weatherElement = document.getElementById('weather');
        const temperature = data.main.temp;
        const weatherDescription = data.weather[0].description;
        
        weatherElement.innerHTML = `
            <h2>현재 날씨</h2>
            <p>온도: ${temperature}°C</p>
            <p>상태: ${weatherDescription}</p>
        `;
    }
  </script>
</html>
{% endblock %}
